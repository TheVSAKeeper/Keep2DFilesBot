# Keep2DFilesBot

Telegram-бот для скачивания файлов по ссылкам с автоматической организацией хранения.

---

## Что это?

Простой бот, который принимает HTTP/HTTPS ссылки, скачивает файлы и раскладывает их по папкам. Для каждого файла
создаётся JSON с метаданными. Всё работает автономно через Docker или локально на .NET 9.

### Основные фичи

✓ Скачивание по прямым ссылкам  
✓ Автоматическая организация: `data/files/<UserId>/<yyyy-MM-dd>/`  
✓ JSON-метаданные для каждого файла  
✓ Ограничения по размеру и таймауту  
✓ Retry-логика через Polly  
✓ Команды `/start` и `/help`

---

## Быстрый старт

### Docker (рекомендуется)

```bash
# Скопировать пример конфигурации
cp .env.example .env

# Отредактировать .env — добавить токен бота и ID пользователей
# BOT_TOKEN=ваш_токен

# Запустить
docker-compose up -d
```

### Локально

Требуется .NET 9 SDK.

```bash
# Восстановить зависимости
dotnet restore

# Настроить appsettings.json или переменные окружения
# Установить BOT_TOKEN

# Запустить
dotnet run --project Keep2DFilesBot/Keep2DFilesBot.csproj
```

---

## Настройка

Основные параметры задаются через `.env` (для Docker) или `appsettings.json`:

| Параметр                   | Описание                      | По умолчанию       |
|----------------------------|-------------------------------|--------------------|
| `BOT_TOKEN`                | Токен бота из @BotFather      | —                  |
| `BOT_ALLOWED_USER_0`       | ID разрешённых пользователей  | —                  |
| `BOT_IS_PUBLIC`            | Публичный доступ (true/false) | false              |
| `DOWNLOAD_MAX_FILE_SIZE`   | Макс. размер файла (байты)    | 104857600 (100 МБ) |
| `DOWNLOAD_TIMEOUT_SECONDS` | Таймаут скачивания (сек)      | 300                |
| `STORAGE_BASE_PATH`        | Корневая папка для файлов     | ./data/files       |

Полный список переменных смотри в `.env.example`.

---

## Команды бота

`/start` — Приветствие  
`/help` — Справка  
Просто отправь ссылку — бот скачает файл

---

## Технологии

- .NET 9 Worker Service
- Telegram.Bot
- Serilog (логи в `logs/` с ротацией)
- Polly (retry/timeout для HTTP)
- Docker + Docker Compose

Архитектура: Vertical Slice + Result Pattern + Pure DI.

---

## Логи

Логи пишутся в консоль и файлы `logs/bot-<дата>.txt` с ежедневной ротацией.

---

## Что ещё не готово

- Whitelist-проверка через конфигурацию
- Команды `/stats` и админ-команды
- Проверка свободного места на диске

Подробный план в [TASKS.md](TASKS.md).

---

## Лицензия

MIT
